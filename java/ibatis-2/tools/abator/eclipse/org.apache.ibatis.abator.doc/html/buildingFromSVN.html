<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Abator Feature Debug Reference</title>
  <link type="text/css" rel="stylesheet" href="abator.css"/>
</head>
<body>
<h1>Abator Feature Debug Reference</h1>
<p>This page contains reference information about how to build and debug Abator
from source.</p>

<h2>Feature Structure</h2>
<p>The Abator feature is structured as four different Eclipse projects - a feature project and
three plug-in projects.  The feature project groups the three plug-ins together for easy
installation.  The Abator feature project is <code>org.apache.ibatis.abator</code>.
This project references the three plug-in projects.  The plug-in projects are structured as
follows:</p>
<table cellspacing="0" cellpadding="5" border="1">
  <tr>
    <th>Plug-in Project</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>org.apache.ibatis.abator.core</code></td>
    <td>This plug-in is an Eclipse library plug-in for the standard Abator JAR file.
      The purpose of this plug-in is to package the standard JAR and make it available to the
      other plug-ins.  There is a build file in this plug-in (buildAbator.xml) that
      will compile the core Abator JAR file and update the wrapped JAR files.  This makes
      it easy to keep the plug-in up to date as the core functionality is developed.</td>
  </tr>
  <tr>
    <td><code>org.apache.ibatis.abator.doc</code></td>
    <td>This plug-in holds the documentation for Abator.  There is a build file in this
      plug-in (buildDoc.xml) that will build the documentation and package it for inclusion
      into the Eclipse help system.</td>
  </tr>
  <tr>
    <td><code>org.apache.ibatis.abator.ui</code></td>
    <td>This plug-in holds the Java code for the Eclipse user interface for Abator.  If you
      are experiencing trouble with the plug-in specific features (like Java file merging), then
      the code for those features will be found in this plug-in.
    </td>
  </tr>
</table>


<h2>Building the Feature and Plug-ins from Source</h2>
<p>The following instructions show how to build the Abator feature and plug-ins from the
latest source
in the Subversion repository.  We assume that you are somewhat familiar with Subversion
and the Eclipse plug-in development environment (PDE).  These instructions also assume
you are using Eclipse version 3.2.  Things are similar in Eclipse 3.1.  The plug-in
code is not supported in versions of Eclipse prior to version 3.1.</p>
<ol>
  <li>Checkout the latest source code from Subversion
    <ol type="a">
      <li>Create a local directory where the source will be stored (for example
      /Abator/source)</li>
      <li>Check out the source tree from the Subversion repository at
       <a href="http://svn.apache.org/repos/asf/ibatis/trunk/java/mapper/mapper2/tools/abator">
       http://svn.apache.org/repos/asf/ibatis/trunk/java/mapper/mapper2/tools/abator</a></li>
    </ol>
  </li>
  <li>Create a new Eclipse workspace directory (for example /EclipseWorkspaces/Abator)</li>
  <li>Start Eclipse and point it to the new workspace directory</li>
  <li>Import the plug-in projects into the workspace
    <ol type="a">
      <li>Start the Eclipse project import wizard
        (File&gt;Import&gt;General&gt;Existing Projects into Workspace)
      </li>
      <li>Set the root directory to the "eclipse" sub-directory of the directory where
        you did the SVN checkout (for example, /Abator/source/eclipse)</li>
      <li>Select the four projects under the directory, do not copy the projects into
        your workspace.  The filled out wizard looks like this: <br />
        <p><img src="importWizard.gif" alt="Eclipse Project Import Wizard"/></p>
      </li>
      <li>Press "Finish", wait for the workspace to build.</li>
    </ol>
  </li>
</ol>

<h2>Debugging</h2>
<p>At this point the projects should be successfully compiled in Eclipse.  If you want to
  debug something in the plug-in, you will need to start another instance of Eclipse
  in debug mode.  The following instructions explain how to do this.</p>

<ol>
    <li>Set a breakpoint in the code you would like to debug.</li>
    <li>Double click on the "plugin.xml" file in the "org.apache.ibatis.abator.ui"
      project.  This should open the plug-in manifest editor.  If some other editor
      opens, then close the editor, right click on "plugin.xml" and select the
      "Open With&gt;Plug-in Manifest Editor" option.</li>
    <li>Select the "Overview" editor tab</li>
    <li>Take the option to "Launch an Eclipse Application in Debug mode".  This will
    start a new instance of Eclipse in debug mode with the Abator plug-ins installed.</li>
</ol>

<p>Once you have the other instance of Eclipse started you should create a new Java project
 in the new workspace, create and fill out an Abator configuration file, and then run Abator.
 Abator should eventually hit your breakpoint, and then you step through the code.</p>
<p>The following classes will likely be of the most interest in debugging:</p>
<table cellspacing="0" cellpadding="5" border="1">
  <tr>
    <th>Class</th>
    <th>Description</th>
  </tr>
  <tr>
    <td><code>org.apache.ibatis.abator.ui.actions.RunAbatorThread</code></td>
    <td>This class is a thread that runs Abator on the selected configuration file.
      You can set a breakpoint in the <code>run</code> method of this class to follow
      the Abator code generation process from the beginning.
    </td>
  </tr>
  <tr>
    <td><code>org.apache.ibatis.abator.ui.plugin.JavaFileMerger</code></td>
    <td>This class implements the Java file merge function.  You can set a breakpoint
      in the <code>getMergedSource</code> method to follow the merging process.
    </td>
  </tr>
</table>

<h2>Building the Documentation</h2>
<p>The documentation for Abator is integrated into the Eclipse help system.
This is accomplished by building an archive file called "doc.zip" that contains
the documentation for the plug-ins, as well as core Abator documentation and Javadoc.
This archive file is not in Subversion because it is a generated file.  If you would
like to rebuild the archive, simply execute the <code>buildDoc.xml</code> file
in the <code>org.apache.ibatis.abator.doc</code> project (an Ant build file).</p>

<h2>Building the Abator Core JAR in Eclipse</h2>
<p>If you would like to debug the Abator core JAR, then you can create a
Java project for the core JAR by following these steps:</p>
<ol>
  <li>Start the Eclipse new project wizard
     (File&gt;New&gt;Project...)
  </li>
  <li>Select the "Java Project from Existing Ant Buildfile" wizard, press "Next"</li>
  <li>Browse to the "build.xml" file in the checked out project (for example
    /Abator/source/core/build/build.xml).  Select the javac target that compiles
    Abator, not the target for compiling generated code in the test targets.
    Accept the default for the other fields and press "Finish".</li>
  <li>Wait for the workspace to build.</li>
</ol>

<p>Note that Abator is compiled with JDK 1.4.2 for distribution.  If you are using a
JSE 5.0 or later compiler you will see many warnings in the workspace related to
type safety.  To disable these warnings, set the compiler compliance level for the
new project to 1.4.</p>

<p>If you make a change in the Abator core files, you can use the <code>buildAbator.xml</code>
Ant build file in the <code>org.apache.ibatis.abator.core</code> project to update the
JAR in the plug-in.</p>

</body>
</html>
