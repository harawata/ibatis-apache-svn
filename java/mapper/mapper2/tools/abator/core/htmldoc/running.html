<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Running Abator</title>
  <link type="text/css" rel="stylesheet" href="abator.css"/>
</head>
<body>
<h1>Running Abator</h1>
<p>Abator can be run in the following ways:</p>
<ul>
  <li>From the command line with an XML configuration</li>
  <li>As an Ant task with an XML configuration</li>
  <li>From another Java program with an XML configuration</li>
  <li>From another Java program with a Java based configuration</li>
</ul>
<p>Each method is described in detail below.  Note that there is also an Eclipse
plugin for Abator that adds extra function - namely good integration into Eclipse,
an Eclipse enabled Ant task, and support for automatic merging of
Java files.  See the Abator home page for information on installing the
Eclipse plugin.</p>

<p><b>Important:</b> When running outside of an IDE environment like Eclipse,
  Abator interprets the <code>targetProject</code> and
  <code>targetPackage</code> attributes in all XML configurations as follows:</p>
<ul>
  <li><code>targetProject</code> is assumed to be an existing directory structure.
    Abator will fail if this directory structure does not exist.</li>
   <li><code>targetPackage</code> will be translated to a suitable subdirectory
     structure of the <code>targetProject</code>
     directory structure.  Abator will create these subdirectories if necessary.</li>
</ul>

<h2>Running Abator from the Command Line</h2>
<p>Abator can be run directly from the command line.  The JAR manifest includes the
   name of the default class (<code>org.apache.ibatis.abator.api.AbatorRunner</code>)
   or you can specify it yourself.  The <code>AbatorRunner</code>
   class takes two arguments: the name of the configuration file,
   and a flag (<code>true</code> or <code>false</code>) specifying whether existing Java files
   should be overwritten.  If the flag is <code>false</code>, and an Java file already exists
   with the same name as a newly generated file, then Abator will write the
   newly generated Java file to the proper directory with a unique name
   (e.g. MyClass.java.1, MyClass.java.2, etc.).</p>
<p>You must still create an Abator XML configuration file.  If the file is
   named "abatorConfig.xml", then any of the following command lines will run
   Abator:</p>
<pre>
   java -jar abator.jar abatorConfig.xml false
   java -jar abator.jar abatorConfig.xml true
   java -cp abator.jar org.apache.ibatis.abator.api.AbatorRunner abatorConfig.xml false
   java -cp abator.jar org.apache.ibatis.abator.api.AbatorRunner abatorConfig.xml true
</pre>

<h2>Running Abator from Ant</h2>
<p>Abator includes a simple Ant task.  The task must be defined in your
  build.xml file, and the task has two parameters.  Here is an example
  build.xml file:</p>
<pre>
   &lt;project default="genfiles" basedir="."&gt;
     &lt;property name="generated.source.dir" value="${basedir}" /&gt;

     &lt;target name="genfiles" description="Generate the files"&gt;
       &lt;taskdef name="abator"
                classname="org.apache.ibatis.abator.ant.AbatorAntTask"
                classpath="abator.jar" /&gt;
       &lt;abator overwrite="true" configfile="abatorConfig.xml" verbose="false" &gt;
         &lt;propertyset&gt;
           &lt;propertyref name="generated.source.dir"/&gt;
         &lt;/propertyset&gt;
       &lt;/abator&gt;
     &lt;/target&gt;
   &lt;/project&gt;
</pre>
<p>Notes:</p>
<ul>
  <li>The classpath on the &lt;taskdef&gt; is used to tell Ant where the implementing
     code is.  This is optional if you add Abator to the Ant classpath in one
     of the other ways described in the Ant manual</li>
   <li>The name of the task can be anything you desire, "abator.genfiles" is
     simply an example</li>
   <li>The "overwrite" attribute is optional.  If "true", "yes", etc. then Abator
     will overwrite any existing Java files.  If "false", "no", etc. then
     Abator will not touch existing Java files - the newly generated Java file
     will be saved with a unique filename instead.  The default is "false".</li>
   <li>The "configfile" attribute is required - it must specify a valid Abator
     configuration XML file.</li>
   <li>The "verbose" attribute is optional.  If "true", "yes", etc then the task will
       log Abator progress messages to the Ant console.  The default is "false".</li>
   <li>The task supports an optional nested <code>&lt;propertyset&gt;</code> element which
       is the standard Ant property set type.  This can be used to pass parameters into
       a configuration file.  For example, the above property
       <code>generated.source.dir</code> can be
       accessed in the Abator configuration file with the escape sequence
       <code>${generated.source.dir}</code>
   </li>
</ul>

<h2>Running Abator from Java with an XML Configuration File</h2>
<p>The following code sample shows how to call Abator from Java.  It does not
   show exception handling, but that should be obvious from the compiler
   errors :)</p>
<pre>
   List warnings = new ArrayList();  // Abator will add Strings to this list
   boolean overwrite = true;
   File configFile = new File("abatorConfig.xml");
   AbatorConfigurationParser cp = new AbatorConfigurationParser(warnings);
   AbatorConfiguration config = cp.parseAbatorConfiguration(configFile);
   DefaultShellCallback callback = new DefaultShellCallback(overwrite);
   Abator abator = new Abator(config, callback, warnings);
   abator.generate(null);
</pre>

<h2>Running Abator from Java with a Java Based Configuration</h2>
<p>The following code sample shows how to call Abator from Java only.  It does
   not show exception handling, but that should be obvious from the compiler
   errors :)</p>
<pre>
   List warnings = new ArrayList();  // Abator will add Strings to this list
   boolean overwrite = true;
   AbatorConfiguration config = new AbatorConfiguration();

   //   ... fill out the config object as appropriate...

   DefaultShellCallback callback = new DefaultShellCallback(overwrite);
   Abator abator = new Abator(config, callback, warnings);
   abator.generate(null);
</pre>

</body>
</html>